<template>
  <div class="page">
    <div class="navbar">
      <div class="navbar-inner sliding">
        <div class="left">
          <a href="/" class="link">
            <i class="icon icon-back"></i>
            <span class="ios-only">Назад</span>
          </a>
        </div>
        <div class="title"><span hidden>Course 1. </span>Слова</div>
      </div>
    </div>
    <div class="page-content">
      <div class="block block-strong text-align-center">
        <h2 id="congrats"></h2>
        <div class="gauge result"></div>
        <p>
          <a @click="restartCourse" class="col button button-round">
            Пройти заново
          </a>
        </p>
      </div>
      <div class="block block-strong">
        <a href="/" class="col button button-large button-round button-fill button-raised">
          Вернуться к заданиям
        </a>
      </div>
    </div>
  </div>
</template>
<script>
  export default {
    data: function () {
      let data = {
        victory: ["Отличный результат!", "Поздравляем! Вы успешно прошли задание"],
        loss: ["Вы можете лучше!", "Ещё разок?"],
      };
      return data;
    },
    methods: {
      restartCourse: function () {
        let context = this;
        let lessonType = this.$route.params.lessonType;
        let lessonId = this.$route.params.lessonId;

        this.$root.setStorage(lessonType + "/" + lessonId, 1);
        this.$root.setStorage(lessonType + "/" + lessonId + "_wrong", 0);

        setTimeout(function () {
          context.$root.setView('lessons/' + lessonType + "/" + lessonId);
        }, 250);
      },
    },
    on: {
      pageAfterIn: async function (e, page) {
        let taskCount = await this.$root.getStorage(this.$route.params.lessonType + "/" + this.$route.params
          .lessonId) - 1;
        let wrongAnswers = await this.$root.getStorage(this.$route.params.lessonType + "/" + this.$route.params
          .lessonId +
          "_wrong");
        let accuracy = taskCount / (taskCount + wrongAnswers);
        var demoGauge = this.$app.gauge.create({
          el: '.result',
          type: 'circle',
          value: accuracy,
          size: 250,
          borderColor: '#2196f3',
          borderWidth: 10,
          valueText: accuracy.toFixed(2) * 100 + '%',
          valueFontSize: 41,
          valueTextColor: '#2196f3',
          labelText: 'точность выполнения',
        });
        if (accuracy > 0.50) {
          this.$root.playSound('success');
          congrats.innerHTML = this.victory[Math.floor(Math.random() * Math.floor(this.victory.length))];
        } else {
          this.$root.playSound('failure');
          demoGauge.update({
            borderColor: '#ef2e52',
            valueTextColor: '#ef2e52',
          });
          congrats.innerHTML = this.loss[Math.floor(Math.random() * Math.floor(this.loss.length))];
        }
      },
    }
  };
</script>